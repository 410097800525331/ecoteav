<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>에코티브 - 브랜드굿즈제작, 티백OEM/ODM, 블렌딩티 개발, 향료 개발</title>
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/package.css">
</head>

<body>
  <div id="header_wrap"></div>
  <section id="package_wrap" data-type="roll">
    <div class="package_inner">
      <!-- 왼쪽: 상품 이미지 -->
      <div class="product_image">
        <div class="main_img">
          <img src="/assets/img/package_roll.jpg" alt="상품 이미지">
        </div>
        <ul class="thumb_list">
          <li><img src="/assets/img/package_roll.jpg" alt="썸네일 1"></li>
          <li><img src="/assets/img/package_roll.jpg" alt="썸네일 2"></li>
          <li><img src="/assets/img/package_roll.jpg" alt="썸네일 3"></li>
        </ul>
      </div>
      <!-- 가운데: 옵션 영역 -->
      <div class="product_options">
        <h2 class="product_title">[소량제작 풀컬러] 자동롤</h2>
        <div class="form_item">
          <label for="size">사이즈</label>
          <input type="text" id="material" value="500mm x400~450m" disabled>
        </div>
        <div class="option_group">
          <label for="material">원단</label>
          <input type="text" id="material" value="PET + VMPET + LLDPE" disabled>
        </div>
        <form class="option_group">
          <fieldset class="option_group2">
            <legend>후가공</legend>
            <div class="option_inner">
              <label>코팅</label>
              <ul class="radio_list">
                <li><label><input type="radio" name="opt2" value="0" required> 유광</label></li>
                <li><label><input type="radio" name="opt2" value="27500"> 무광</label></li>
              </ul>
              <div>0원</div>
            </div>
            <div class="option_inner">
              <label>이지컷</label>
              <ul class="radio_list">
                <li><label><input type="radio" name="opt8" value="137500" required> 있음</label></li>
                <li><label><input type="radio" name="opt8" value="0"> 없음</label></li>
              </ul>
              <div>0원</div>
            </div>
            <div class="option_inner">
              <label>디자인 작업종류</label>
              <ul class="radio_list">
                <li><label><input type="radio" name="opt7" value="opt1T" checked> 1종</label></li>
                <li><label><input type="radio" name="opt7" value="opt2T"> 2종</label></li>
              </ul>
              <div>0원</div>
            </div>
          </fieldset>
        </form>
        <div class="option_group">
          <label for="file">디자인 파일</label>
          <input type="file" id="file" multiple accept=".ai">
        </div>
        <div class="option_group qty_group">
          <label for="qty">수량</label>
          <div class="qty_box">
            <button type="button" class="qty_btn minus">
              <i class="fa-solid fa-minus"></i>
            </button>
            <input type="number" id="qty" value="1" min="1">
            <button type="button" class="qty_btn plus">
              <i class="fa-solid fa-plus"></i>
            </button>
            <div>= <span>1장</span></div>
          </div>
        </div>
      </div>
      <!-- 오른쪽: 가격 및 결제 -->
      <div class="product_summary">
        <div class="summary_box">
          <p><strong>가격</strong> <span id="price">0원</span></p>
          <p><strong>추가금액</strong> <span id="add_price">0원</span></p>
          <p><strong>1장당</strong> <span id="unit_price">0원</span></p>
          <p><strong>최종결제금액</strong> <span id="total_price">0원</span></p>
        </div>
        <div class="btn_area">
          <button type="button" class="btn_ basic_btn_w">장바구니 담기</button>
          <button type="button" class="btn_ basic_btn_b">구매하기</button>
          <!-- <button type="button" class="btn_buy">견적인쇄하기</button> 추후 업데이트-->
        </div>
      </div>
    </div>
  </section>
  <div id="product_detail"></div>
  <div id="footer_wrap"></div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    $(document).ready(function () {

      const type = $('#package_wrap').data('type');

      if (type !== 'roll') return; // 자동롤일 때만 실행

      const BASE_PRICE = 865000;

      const qtyInput = $('#qty');
      const plusBtn = $('.plus');
      const minusBtn = $('.minus');

      const priceEl = $('#price');
      const addPriceEl = $('#add_price');
      const unitPriceEl = $('#unit_price');
      const totalPriceEl = $('#total_price');

      const buyBtn = $('.basic_btn_b');
      const cartBtn = $('.basic_btn_w');
      const qtyGroup = $('.qty_group');

      let qty = 1;

      /* =========================
          수량 표시 영역 생성
      ========================= */

      if (!$('.qty_display').length) {
        qtyGroup.append(`
      <div class="qty_display">
        = <span class="qty_text">1장</span>
        <div class="design_extra"></div>
        <div class="qty_notice">제품 사이즈에 따라 인쇄 수량이 달라집니다. 자세한 내용은 상담을 통해 확인 가능합니다.</div>
      </div>
    `);
      }

      const qtyTextEl = $('.qty_text');
      const designExtraEl = $('.design_extra');

      /* =========================
          필수 옵션 체크
      ========================= */

      function isAllOptionsSelected() {

        let valid = true;

        $('.option_inner').each(function () {

          const name = $(this).find('input[type=radio]').first().attr('name');

          if (!$(`input[name="${name}"]:checked`).length) {
            valid = false;
          }

        });

        return valid;
      }

      function setButtonsState(enabled) {
        buyBtn.prop('disabled', !enabled);
        cartBtn.prop('disabled', !enabled);
      }

      /* =========================
          수량 버튼
      ========================= */

      plusBtn.on('click', function () {
        qty++;
        qtyInput.val(qty);
        updateAll();
      });

      minusBtn.on('click', function () {
        if (qty > 1) {
          qty--;
          qtyInput.val(qty);
          updateAll();
        }
      });

      /* =========================
          옵션 변경
      ========================= */

      $('input[type=radio]').on('change', function () {
        updateAll();
      });

      /* =========================
          전체 계산
      ========================= */

      function updateAll() {

        if (!isAllOptionsSelected()) {
          resetPrice();
          setButtonsState(false);
          return;
        }

        setButtonsState(true);

        /* ----- 수량 표시 ----- */

        qtyTextEl.text(qty + "장");

        const designType = $('input[name="opt7"]:checked').val();

        if (designType === "opt2T") {

          let eachQty = 1;

          if (qty >= 3) {
            eachQty = qty - 1;
          }

          designExtraEl.text(`(상품종류별 각 ${eachQty}장)`);

        } else {
          designExtraEl.text("");
        }

        /* ----- 후가공 금액 ----- */

        let addPrice = 0;

        $('.option_inner').each(function () {

          const checked = $(this).find('input[type=radio]:checked');
          const priceBox = $(this).find('div').last();

          const val = checked.val();

          if (!isNaN(val)) {
            const num = Number(val);
            addPrice += num;
            priceBox.text(num.toLocaleString() + "원");
          } else {
            priceBox.text("0원");
          }

        });

        const totalPrice = BASE_PRICE + addPrice;
        const unitPrice = Math.floor(totalPrice / qty);

        priceEl.text(BASE_PRICE.toLocaleString() + "원");
        addPriceEl.text(addPrice.toLocaleString() + "원");
        totalPriceEl.text(totalPrice.toLocaleString() + "원");
        unitPriceEl.text(unitPrice.toLocaleString() + "원");
      }

      function resetPrice() {
        priceEl.text("0원");
        addPriceEl.text("0원");
        totalPriceEl.text("0원");
        unitPriceEl.text("0원");
      }

      /* 초기 상태 */

      setButtonsState(false);
    });
  </script>
  <script src="/js/include.js"></script>
  <script src="/js/product_detail.js"></script>
</body>

</html>